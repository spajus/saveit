<%- if not current_user %>
window.location.assign('<%= url_for controller: :home, only_path: false %>');
<%- else -%>
function submitBmForm(){
    var elms = document.getElementById("saveitin-form").elements;
    var title = elms[name="bookmark[title]"].value;
    var description = elms[name="bookmark[description]"].value;
    var tags = elms[name="bookmark[tags]"].value;
    var url = '<%= request.protocol + request.host_with_port %>/zimg/<%= @bookmark.id %>?title=' + encodeURIComponent(title) +'&description=' +encodeURIComponent(description) + '&tags=' +encodeURIComponent(tags);
    console.log(url);

    var img = document.createElement("img");
    img.setAttribute('src', url);
    img.setAttribute('alt', 'na');
    img.setAttribute('height', '1px');
    img.setAttribute('width', '1px');
    document.body.appendChild(img);
    var bm_div = document.getElementById('bm-notification-id');
    document.body.removeChild(bm_div);
    return false;
}

function showFormEdit(){
    var btn = document.getElementById("saveitin-edit-button");
    btn.setAttribute("style", "display:none;");
    var frm = document.getElementById("saveitin-form");
    frm.setAttribute("style", "display:block;");
}

function removeBmPopup() {
    if (frm = document.getElementById("saveitin-form")) {
        var style = document.defaultView.getComputedStyle(frm,null).getPropertyValue("display");
        if (style == "none") {
            if ( n = document.getElementById('bm-notification-id')) {
                document.body.removeChild(n);
            }
        }
    }
}

el=document.createElement('div');
el.setAttribute('id','bm-notification-id');

el.innerHTML = '<%= render('bookmark-div').gsub(/\s*\n/, '').html_safe %>';
document.body.appendChild(el);

setTimeout('removeBmPopup()', 3000);
<%- end %>